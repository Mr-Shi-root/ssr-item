# SSR ç¼“å­˜ç­–ç•¥è¯¦è§£

## ğŸ¯ æ ¸å¿ƒé—®é¢˜ï¼šSSR ä¸­çš„æ¸²æŸ“é€»è¾‘å¯ä»¥ç¼“å­˜å—ï¼Ÿ

### ç®€çŸ­å›ç­”

**æ¸²æŸ“é€»è¾‘æœ¬èº«ä¸èƒ½ç¼“å­˜ï¼Œä½†æ¸²æŸ“ç»“æœå¯ä»¥ç¼“å­˜ã€‚**

---

## ğŸ“Š SSR ç¼“å­˜çš„æœ¬è´¨

### 1. ä»€ä¹ˆæ˜¯"æ¸²æŸ“é€»è¾‘"ï¼Ÿ

```javascript
// è¿™æ˜¯æ¸²æŸ“é€»è¾‘ï¼ˆä»£ç ï¼‰
function renderItemPage(itemData) {
  return ReactDOMServer.renderToString(
    <ItemPage item={itemData} />
  );
}
```

**æ¸²æŸ“é€»è¾‘ = ä»£ç  = å‡½æ•°**
- è¿™æ˜¯ JavaScript ä»£ç ï¼Œå­˜å‚¨åœ¨æœåŠ¡å™¨çš„å†…å­˜ä¸­
- æ¯æ¬¡è¯·æ±‚éƒ½ä¼šæ‰§è¡Œè¿™æ®µä»£ç 
- **æ¸²æŸ“é€»è¾‘æœ¬èº«ä¸éœ€è¦ç¼“å­˜**ï¼ˆä»£ç å·²ç»åœ¨å†…å­˜ä¸­äº†ï¼‰

### 2. ä»€ä¹ˆæ˜¯"æ¸²æŸ“ç»“æœ"ï¼Ÿ

```javascript
// è¿™æ˜¯æ¸²æŸ“ç»“æœï¼ˆHTML å­—ç¬¦ä¸²ï¼‰
const html = `
  <div class="item-page">
    <h1>iPhone 15 Pro Max</h1>
    <p class="price">Â¥9999</p>
    <button>ç«‹å³è´­ä¹°</button>
  </div>
`;
```

**æ¸²æŸ“ç»“æœ = HTML å­—ç¬¦ä¸² = æ•°æ®**
- è¿™æ˜¯æ‰§è¡Œæ¸²æŸ“é€»è¾‘åäº§ç”Ÿçš„ HTML
- æ¯æ¬¡è¯·æ±‚éƒ½è¦é‡æ–°ç”Ÿæˆï¼ˆå¦‚æœä¸ç¼“å­˜ï¼‰
- **æ¸²æŸ“ç»“æœå¯ä»¥ç¼“å­˜**ï¼ˆé¿å…é‡å¤æ¸²æŸ“ï¼‰

---

## ğŸ”¬ æ·±åº¦è§£æï¼šSSR çš„æ‰§è¡Œè¿‡ç¨‹

### å®Œæ•´æµç¨‹

```javascript
// ç”¨æˆ·è¯·æ±‚ï¼šGET /item/12345

app.get('/item/:id', async (req, res) => {
  const itemId = req.params.id;

  // ========== æ­¥éª¤ 1ï¼šæŸ¥è¯¢æ•°æ® ==========
  // è€—æ—¶ï¼š50-200ms
  const itemData = await fetchItemData(itemId);
  // itemData = { id: 12345, title: 'iPhone 15', price: 9999 }

  // ========== æ­¥éª¤ 2ï¼šæ‰§è¡Œæ¸²æŸ“é€»è¾‘ ==========
  // è€—æ—¶ï¼š50-150ms
  const html = ReactDOMServer.renderToString(
    <ItemPage item={itemData} />
  );
  // html = "<div>...</div>" (5KB HTML å­—ç¬¦ä¸²)

  // ========== æ­¥éª¤ 3ï¼šè¿”å›ç»“æœ ==========
  res.send(html);
});

// æ€»è€—æ—¶ï¼š100-350ms
```

### é—®é¢˜åˆ†æ

**æ¯æ¬¡è¯·æ±‚éƒ½è¦æ‰§è¡Œæ­¥éª¤ 1 å’Œæ­¥éª¤ 2ï¼Œéå¸¸è€—æ—¶ï¼**

```
ç¬¬ 1 ä¸ªç”¨æˆ·è¯·æ±‚ï¼š
â”œâ”€ æŸ¥è¯¢æ•°æ®: 100ms
â”œâ”€ æ‰§è¡Œæ¸²æŸ“: 100ms
â””â”€ æ€»è€—æ—¶: 200ms

ç¬¬ 2 ä¸ªç”¨æˆ·è¯·æ±‚ï¼ˆç›¸åŒå•†å“ï¼‰ï¼š
â”œâ”€ æŸ¥è¯¢æ•°æ®: 100ms  â† é‡å¤æŸ¥è¯¢ï¼
â”œâ”€ æ‰§è¡Œæ¸²æŸ“: 100ms  â† é‡å¤æ¸²æŸ“ï¼
â””â”€ æ€»è€—æ—¶: 200ms

ç¬¬ 3 ä¸ªç”¨æˆ·è¯·æ±‚ï¼ˆç›¸åŒå•†å“ï¼‰ï¼š
â”œâ”€ æŸ¥è¯¢æ•°æ®: 100ms  â† åˆé‡å¤æŸ¥è¯¢ï¼
â”œâ”€ æ‰§è¡Œæ¸²æŸ“: 100ms  â† åˆé‡å¤æ¸²æŸ“ï¼
â””â”€ æ€»è€—æ—¶: 200ms

é—®é¢˜ï¼šç›¸åŒå•†å“è¢«è®¿é—® 1000 æ¬¡ï¼Œå°±è¦æŸ¥è¯¢ 1000 æ¬¡ã€æ¸²æŸ“ 1000 æ¬¡ï¼
```

---

## âœ… è§£å†³æ–¹æ¡ˆï¼šç¼“å­˜æ¸²æŸ“ç»“æœ

### æ–¹æ¡ˆ 1ï¼šç¼“å­˜æœ€ç»ˆ HTMLï¼ˆæ¨èï¼‰

```javascript
const cache = new LRU({ max: 1000 });

app.get('/item/:id', async (req, res) => {
  const itemId = req.params.id;
  const cacheKey = `item:${itemId}`;

  // ========== å…ˆæŸ¥ç¼“å­˜ ==========
  let html = cache.get(cacheKey);

  if (html) {
    // ç¼“å­˜å‘½ä¸­ï¼ç›´æ¥è¿”å›
    console.log('ç¼“å­˜å‘½ä¸­ï¼Œè€—æ—¶: 1ms');
    res.send(html);
    return;
  }

  // ========== ç¼“å­˜æœªå‘½ä¸­ï¼Œæ‰§è¡Œæ¸²æŸ“ ==========
  console.log('ç¼“å­˜æœªå‘½ä¸­ï¼Œå¼€å§‹æ¸²æŸ“');

  // æ­¥éª¤ 1ï¼šæŸ¥è¯¢æ•°æ®ï¼ˆ100msï¼‰
  const itemData = await fetchItemData(itemId);

  // æ­¥éª¤ 2ï¼šæ‰§è¡Œæ¸²æŸ“é€»è¾‘ï¼ˆ100msï¼‰
  html = ReactDOMServer.renderToString(
    <ItemPage item={itemData} />
  );

  // æ­¥éª¤ 3ï¼šå†™å…¥ç¼“å­˜
  cache.set(cacheKey, html, 300); // ç¼“å­˜ 5 åˆ†é’Ÿ

  // æ­¥éª¤ 4ï¼šè¿”å›ç»“æœ
  res.send(html);
});
```

**æ•ˆæœå¯¹æ¯”**ï¼š

```
ç¬¬ 1 ä¸ªç”¨æˆ·è¯·æ±‚ï¼š
â”œâ”€ ç¼“å­˜æœªå‘½ä¸­
â”œâ”€ æŸ¥è¯¢æ•°æ®: 100ms
â”œâ”€ æ‰§è¡Œæ¸²æŸ“: 100ms
â”œâ”€ å†™å…¥ç¼“å­˜: 1ms
â””â”€ æ€»è€—æ—¶: 201ms

ç¬¬ 2 ä¸ªç”¨æˆ·è¯·æ±‚ï¼ˆç›¸åŒå•†å“ï¼‰ï¼š
â”œâ”€ ç¼“å­˜å‘½ä¸­ï¼âœ…
â”œâ”€ è¯»å–ç¼“å­˜: 1ms
â””â”€ æ€»è€—æ—¶: 1ms  â† å¿«äº† 200 å€ï¼

ç¬¬ 3-1000 ä¸ªç”¨æˆ·è¯·æ±‚ï¼ˆ5åˆ†é’Ÿå†…ï¼‰ï¼š
â”œâ”€ ç¼“å­˜å‘½ä¸­ï¼âœ…
â”œâ”€ è¯»å–ç¼“å­˜: 1ms
â””â”€ æ€»è€—æ—¶: 1ms

å¹³å‡è€—æ—¶ï¼š(201 + 1*999) / 1000 = 1.2ms
æ€§èƒ½æå‡ï¼š200ms / 1.2ms = 166 å€ï¼
```

### æ–¹æ¡ˆ 2ï¼šç¼“å­˜æ•°æ® + æ¸²æŸ“é€»è¾‘ä¸ç¼“å­˜

```javascript
const dataCache = new LRU({ max: 1000 });

app.get('/item/:id', async (req, res) => {
  const itemId = req.params.id;
  const cacheKey = `data:${itemId}`;

  // ========== ç¼“å­˜æ•°æ® ==========
  let itemData = dataCache.get(cacheKey);

  if (!itemData) {
    // æ•°æ®ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“
    itemData = await fetchItemData(itemId); // 100ms
    dataCache.set(cacheKey, itemData, 300);
  }

  // ========== æ¯æ¬¡éƒ½æ‰§è¡Œæ¸²æŸ“é€»è¾‘ ==========
  const html = ReactDOMServer.renderToString(
    <ItemPage item={itemData} />
  ); // 100ms

  res.send(html);
});
```

**æ•ˆæœå¯¹æ¯”**ï¼š

```
ç¬¬ 1 ä¸ªç”¨æˆ·è¯·æ±‚ï¼š
â”œâ”€ æ•°æ®ç¼“å­˜æœªå‘½ä¸­
â”œâ”€ æŸ¥è¯¢æ•°æ®: 100ms
â”œâ”€ æ‰§è¡Œæ¸²æŸ“: 100ms  â† æ¯æ¬¡éƒ½è¦æ¸²æŸ“
â””â”€ æ€»è€—æ—¶: 200ms

ç¬¬ 2 ä¸ªç”¨æˆ·è¯·æ±‚ï¼ˆç›¸åŒå•†å“ï¼‰ï¼š
â”œâ”€ æ•°æ®ç¼“å­˜å‘½ä¸­ï¼
â”œâ”€ è¯»å–ç¼“å­˜: 1ms
â”œâ”€ æ‰§è¡Œæ¸²æŸ“: 100ms  â† è¿˜æ˜¯è¦æ¸²æŸ“ï¼
â””â”€ æ€»è€—æ—¶: 101ms

ç¬¬ 3-1000 ä¸ªç”¨æˆ·è¯·æ±‚ï¼š
â”œâ”€ æ•°æ®ç¼“å­˜å‘½ä¸­ï¼
â”œâ”€ è¯»å–ç¼“å­˜: 1ms
â”œâ”€ æ‰§è¡Œæ¸²æŸ“: 100ms  â† æ¯æ¬¡éƒ½è¦æ¸²æŸ“ï¼
â””â”€ æ€»è€—æ—¶: 101ms

å¹³å‡è€—æ—¶ï¼š(200 + 101*999) / 1000 = 101ms
æ€§èƒ½æå‡ï¼š200ms / 101ms = 2 å€
```

**ç»“è®º**ï¼š
- æ–¹æ¡ˆ 1ï¼ˆç¼“å­˜ HTMLï¼‰ï¼šæ€§èƒ½æå‡ **166 å€**
- æ–¹æ¡ˆ 2ï¼ˆç¼“å­˜æ•°æ®ï¼‰ï¼šæ€§èƒ½æå‡ **2 å€**
- **æ–¹æ¡ˆ 1 å®Œèƒœï¼**

---

## ğŸ¤” ä¸ºä»€ä¹ˆä¸èƒ½åªç¼“å­˜æ•°æ®ï¼Ÿ

### é—®é¢˜ï¼šæ¸²æŸ“é€»è¾‘å¾ˆè€—æ—¶

```javascript
// æ¸²æŸ“ä¸€ä¸ªå¤æ‚çš„å•†å“é¡µé¢
function renderItemPage(itemData) {
  return ReactDOMServer.renderToString(
    <ItemPage item={itemData}>
      <Header />                    // 10ms
      <ProductImages />             // 20ms
      <ProductInfo />               // 15ms
      <ProductDescription />        // 25ms
      <Reviews count={1000} />      // 30ms  â† æ¸²æŸ“ 1000 æ¡è¯„è®ºï¼
      <Recommendations />           // 20ms
      <Footer />                    // 10ms
    </ItemPage>
  );
}

// æ€»è€—æ—¶ï¼š130ms
```

**å³ä½¿æ•°æ®å·²ç¼“å­˜ï¼Œæ¯æ¬¡è¯·æ±‚è¿˜è¦èŠ± 130ms æ¸²æŸ“ HTMLï¼**

### çœŸå®æ¡ˆä¾‹ï¼šæ·˜å®å•†å“é¡µ

```
å•†å“é¡µé¢å¤æ‚åº¦ï¼š
â”œâ”€ å•†å“ä¿¡æ¯æ¨¡å—
â”œâ”€ å•†å“å›¾ç‰‡è½®æ’­ï¼ˆ10 å¼ å›¾ï¼‰
â”œâ”€ å•†å“è¯¦æƒ…ï¼ˆå¯Œæ–‡æœ¬ï¼Œ5000 å­—ï¼‰
â”œâ”€ ç”¨æˆ·è¯„è®ºï¼ˆ1000 æ¡ï¼‰
â”œâ”€ æ¨èå•†å“ï¼ˆ20 ä¸ªï¼‰
â”œâ”€ åº—é“ºä¿¡æ¯
â””â”€ åº•éƒ¨å¯¼èˆª

æ¸²æŸ“è€—æ—¶ï¼š
â”œâ”€ æ•°æ®å·²ç¼“å­˜ï¼š1ms
â”œâ”€ æ‰§è¡Œæ¸²æŸ“é€»è¾‘ï¼š300ms  â† éå¸¸è€—æ—¶ï¼
â””â”€ æ€»è€—æ—¶ï¼š301ms

å¦‚æœç¼“å­˜ HTMLï¼š
â”œâ”€ è¯»å–ç¼“å­˜ï¼š1ms
â””â”€ æ€»è€—æ—¶ï¼š1ms

æ€§èƒ½æå‡ï¼š301ms / 1ms = 301 å€ï¼
```

---

## ğŸ“Š ä¸‰ç§ç¼“å­˜ç­–ç•¥å¯¹æ¯”

### ç­–ç•¥ 1ï¼šä¸ç¼“å­˜ï¼ˆæœ€å·®ï¼‰

```javascript
app.get('/item/:id', async (req, res) => {
  const itemData = await fetchItemData(req.params.id); // 100ms
  const html = renderToString(<ItemPage item={itemData} />); // 100ms
  res.send(html);
});

// æ¯æ¬¡è¯·æ±‚ï¼š200ms
// 1000 æ¬¡è¯·æ±‚ï¼š200,000ms = 200 ç§’
// æœåŠ¡å™¨å‹åŠ›ï¼šæå¤§
```

### ç­–ç•¥ 2ï¼šåªç¼“å­˜æ•°æ®ï¼ˆä¸€èˆ¬ï¼‰

```javascript
app.get('/item/:id', async (req, res) => {
  let itemData = dataCache.get(req.params.id);
  if (!itemData) {
    itemData = await fetchItemData(req.params.id); // 100msï¼ˆé¦–æ¬¡ï¼‰
    dataCache.set(req.params.id, itemData);
  }
  const html = renderToString(<ItemPage item={itemData} />); // 100msï¼ˆæ¯æ¬¡ï¼‰
  res.send(html);
});

// é¦–æ¬¡è¯·æ±‚ï¼š200ms
// åç»­è¯·æ±‚ï¼š101msï¼ˆ1ms è¯»ç¼“å­˜ + 100ms æ¸²æŸ“ï¼‰
// 1000 æ¬¡è¯·æ±‚ï¼š200 + 101*999 = 101,099ms = 101 ç§’
// æœåŠ¡å™¨å‹åŠ›ï¼šå¤§ï¼ˆæ¯æ¬¡éƒ½è¦æ¸²æŸ“ï¼‰
```

### ç­–ç•¥ 3ï¼šç¼“å­˜ HTMLï¼ˆæœ€ä¼˜ï¼‰âœ…

```javascript
app.get('/item/:id', async (req, res) => {
  let html = htmlCache.get(req.params.id);
  if (!html) {
    const itemData = await fetchItemData(req.params.id); // 100msï¼ˆé¦–æ¬¡ï¼‰
    html = renderToString(<ItemPage item={itemData} />); // 100msï¼ˆé¦–æ¬¡ï¼‰
    htmlCache.set(req.params.id, html);
  }
  res.send(html);
});

// é¦–æ¬¡è¯·æ±‚ï¼š201ms
// åç»­è¯·æ±‚ï¼š1msï¼ˆè¯»ç¼“å­˜ï¼‰
// 1000 æ¬¡è¯·æ±‚ï¼š201 + 1*999 = 1,200ms = 1.2 ç§’
// æœåŠ¡å™¨å‹åŠ›ï¼šæå°
```

**æ€§èƒ½å¯¹æ¯”**ï¼š

| ç­–ç•¥ | 1000æ¬¡è¯·æ±‚æ€»è€—æ—¶ | å¹³å‡è€—æ—¶ | æœåŠ¡å™¨å‹åŠ› |
|-----|----------------|---------|-----------|
| ä¸ç¼“å­˜ | 200 ç§’ | 200ms | æå¤§ |
| åªç¼“å­˜æ•°æ® | 101 ç§’ | 101ms | å¤§ |
| ç¼“å­˜ HTML | **1.2 ç§’** | **1.2ms** | **æå°** |

---

## ğŸ¯ å®æˆ˜ï¼šå¤šçº§ç¼“å­˜æ¶æ„

### å®Œæ•´å®ç°

```javascript
const LRU = require('lru-cache');
const Redis = require('ioredis');

// L1 ç¼“å­˜ï¼šå†…å­˜ï¼ˆæœ€å¿«ï¼Œå®¹é‡å°ï¼‰
const memoryCache = new LRU({
  max: 1000,        // æœ€å¤šç¼“å­˜ 1000 ä¸ªé¡µé¢
  ttl: 60 * 1000    // 1 åˆ†é’Ÿè¿‡æœŸ
});

// L2 ç¼“å­˜ï¼šRedisï¼ˆå¿«ï¼Œå®¹é‡å¤§ï¼‰
const redisCache = new Redis();

async function renderWithCache(itemId) {
  const cacheKey = `item:${itemId}`;

  // ========== L1ï¼šå†…å­˜ç¼“å­˜ ==========
  let html = memoryCache.get(cacheKey);
  if (html) {
    console.log('L1 ç¼“å­˜å‘½ä¸­ï¼ˆå†…å­˜ï¼‰');
    return html;
  }

  // ========== L2ï¼šRedis ç¼“å­˜ ==========
  html = await redisCache.get(cacheKey);
  if (html) {
    console.log('L2 ç¼“å­˜å‘½ä¸­ï¼ˆRedisï¼‰');
    // å›å†™åˆ° L1
    memoryCache.set(cacheKey, html);
    return html;
  }

  // ========== ç¼“å­˜æœªå‘½ä¸­ï¼šæ‰§è¡Œæ¸²æŸ“ ==========
  console.log('ç¼“å­˜æœªå‘½ä¸­ï¼Œå¼€å§‹æ¸²æŸ“');

  // 1. æŸ¥è¯¢æ•°æ®
  const itemData = await fetchItemData(itemId);

  // 2. æ‰§è¡Œæ¸²æŸ“é€»è¾‘
  html = ReactDOMServer.renderToString(
    <ItemPage item={itemData} />
  );

  // 3. å†™å…¥ç¼“å­˜
  memoryCache.set(cacheKey, html);
  await redisCache.set(cacheKey, html, 'EX', 300); // 5 åˆ†é’Ÿ

  return html;
}

// ä½¿ç”¨
app.get('/item/:id', async (req, res) => {
  const html = await renderWithCache(req.params.id);
  res.send(html);
});
```

### æ€§èƒ½æ•°æ®

```
åœºæ™¯ï¼š1000 ä¸ªç”¨æˆ·è®¿é—®åŒä¸€ä¸ªå•†å“

ç¬¬ 1 ä¸ªç”¨æˆ·ï¼š
â”œâ”€ L1 æœªå‘½ä¸­
â”œâ”€ L2 æœªå‘½ä¸­
â”œâ”€ æŸ¥è¯¢æ•°æ®: 100ms
â”œâ”€ æ‰§è¡Œæ¸²æŸ“: 100ms
â”œâ”€ å†™å…¥ç¼“å­˜: 2ms
â””â”€ æ€»è€—æ—¶: 202ms

ç¬¬ 2-100 ä¸ªç”¨æˆ·ï¼ˆ1åˆ†é’Ÿå†…ï¼‰ï¼š
â”œâ”€ L1 å‘½ä¸­ï¼âœ…
â”œâ”€ è¯»å–å†…å­˜: 0.1ms
â””â”€ æ€»è€—æ—¶: 0.1ms

ç¬¬ 101 ä¸ªç”¨æˆ·ï¼ˆ1åˆ†é’Ÿåï¼ŒL1 è¿‡æœŸï¼‰ï¼š
â”œâ”€ L1 æœªå‘½ä¸­
â”œâ”€ L2 å‘½ä¸­ï¼âœ…
â”œâ”€ è¯»å– Redis: 1ms
â”œâ”€ å›å†™ L1: 0.1ms
â””â”€ æ€»è€—æ—¶: 1.1ms

ç¬¬ 102-1000 ä¸ªç”¨æˆ·ï¼š
â”œâ”€ L1 å‘½ä¸­ï¼âœ…
â”œâ”€ è¯»å–å†…å­˜: 0.1ms
â””â”€ æ€»è€—æ—¶: 0.1ms

å¹³å‡è€—æ—¶ï¼š(202 + 0.1*99 + 1.1 + 0.1*899) / 1000 = 0.3ms
æ€§èƒ½æå‡ï¼š200ms / 0.3ms = 666 å€ï¼
```

---

## âš ï¸ å¸¸è§è¯¯åŒº

### è¯¯åŒº 1ï¼š"æ¸²æŸ“é€»è¾‘å¯ä»¥ç¼“å­˜"

```javascript
// âŒ é”™è¯¯ç†è§£
const renderLogicCache = new Map();

function getRenderLogic(itemId) {
  if (!renderLogicCache.has(itemId)) {
    // ç¼“å­˜æ¸²æŸ“é€»è¾‘ï¼Ÿï¼Ÿï¼Ÿ
    renderLogicCache.set(itemId, function(data) {
      return renderToString(<ItemPage item={data} />);
    });
  }
  return renderLogicCache.get(itemId);
}

// é—®é¢˜ï¼šæ¸²æŸ“é€»è¾‘æ˜¯ä»£ç ï¼Œå·²ç»åœ¨å†…å­˜ä¸­äº†ï¼Œä¸éœ€è¦ç¼“å­˜ï¼
// è€Œä¸”æ¯æ¬¡è¿˜æ˜¯è¦æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œæ²¡æœ‰ä»»ä½•æ€§èƒ½æå‡ï¼
```

**æ­£ç¡®ç†è§£**ï¼š
- æ¸²æŸ“é€»è¾‘ = ä»£ç  = å‡½æ•°å®šä¹‰
- ä»£ç å·²ç»åœ¨å†…å­˜ä¸­ï¼Œä¸éœ€è¦ç¼“å­˜
- éœ€è¦ç¼“å­˜çš„æ˜¯**æ‰§è¡Œç»“æœ**ï¼ˆHTML å­—ç¬¦ä¸²ï¼‰

### è¯¯åŒº 2ï¼š"ç¼“å­˜æ•°æ®å°±å¤Ÿäº†"

```javascript
// âŒ ä¸å¤Ÿä¼˜åŒ–
const dataCache = new Map();

app.get('/item/:id', async (req, res) => {
  let data = dataCache.get(req.params.id);
  if (!data) {
    data = await fetchItemData(req.params.id);
    dataCache.set(req.params.id, data);
  }

  // æ¯æ¬¡éƒ½è¦æ‰§è¡Œæ¸²æŸ“ï¼è€—æ—¶ 100ms
  const html = renderToString(<ItemPage item={data} />);
  res.send(html);
});

// é—®é¢˜ï¼šè™½ç„¶æ•°æ®ç¼“å­˜äº†ï¼Œä½†æ¯æ¬¡è¿˜è¦æ¸²æŸ“ 100ms
```

**æ­£ç¡®åšæ³•**ï¼š
- ç¼“å­˜æœ€ç»ˆçš„ HTML å­—ç¬¦ä¸²
- é¿å…é‡å¤æ‰§è¡Œæ¸²æŸ“é€»è¾‘

### è¯¯åŒº 3ï¼š"æ‰€æœ‰é¡µé¢éƒ½ç¼“å­˜"

```javascript
// âŒ ä¸åˆç†
app.get('/user/profile', async (req, res) => {
  const userId = req.user.id;
  const cacheKey = `profile:${userId}`;

  let html = cache.get(cacheKey);
  if (!html) {
    const userData = await fetchUserData(userId);
    html = renderToString(<ProfilePage user={userData} />);
    cache.set(cacheKey, html, 300); // ç¼“å­˜ 5 åˆ†é’Ÿ
  }

  res.send(html);
});

// é—®é¢˜ï¼šç”¨æˆ·èµ„æ–™æ˜¯ä¸ªæ€§åŒ–å†…å®¹ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½ä¸åŒ
// ç¼“å­˜å‘½ä¸­ç‡æä½ï¼Œæµªè´¹å†…å­˜ï¼
```

**æ­£ç¡®åšæ³•**ï¼š
- åªç¼“å­˜**å…¬å…±å†…å®¹**ï¼ˆå¦‚å•†å“é¡µã€æ–‡ç« é¡µï¼‰
- **ä¸ªæ€§åŒ–å†…å®¹**ä¸ç¼“å­˜ï¼ˆå¦‚ç”¨æˆ·ä¸­å¿ƒã€è´­ç‰©è½¦ï¼‰

---

## ğŸ¯ ç¼“å­˜å†³ç­–æ ‘

```
è¿™ä¸ªé¡µé¢åº”è¯¥ç¼“å­˜å—ï¼Ÿ
  â”‚
  â”œâ”€ å†…å®¹æ˜¯å¦ä¸ªæ€§åŒ–ï¼Ÿ
  â”‚   â”œâ”€ æ˜¯ï¼ˆç”¨æˆ·ä¸­å¿ƒã€è´­ç‰©è½¦ï¼‰â†’ ä¸ç¼“å­˜
  â”‚   â””â”€ å¦ â†’ ç»§ç»­
  â”‚
  â”œâ”€ æ•°æ®æ˜¯å¦å®æ—¶å˜åŒ–ï¼Ÿ
  â”‚   â”œâ”€ æ˜¯ï¼ˆç§’æ€ã€è‚¡ç¥¨ï¼‰â†’ ä¸ç¼“å­˜
  â”‚   â””â”€ å¦ â†’ ç»§ç»­
  â”‚
  â”œâ”€ è®¿é—®é¢‘ç‡æ˜¯å¦é«˜ï¼Ÿ
  â”‚   â”œâ”€ æ˜¯ï¼ˆçƒ­é—¨å•†å“ï¼‰â†’ ç¼“å­˜ HTML âœ…
  â”‚   â””â”€ å¦ â†’ ç¼“å­˜æ•°æ®å³å¯
  â”‚
  â””â”€ æ¸²æŸ“æ˜¯å¦è€—æ—¶ï¼Ÿ
      â”œâ”€ æ˜¯ï¼ˆå¤æ‚é¡µé¢ï¼‰â†’ ç¼“å­˜ HTML âœ…
      â””â”€ å¦ â†’ ç¼“å­˜æ•°æ®å³å¯
```

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒç»“è®º

1. **æ¸²æŸ“é€»è¾‘ä¸èƒ½ç¼“å­˜**ï¼ˆä»£ç å·²ç»åœ¨å†…å­˜ä¸­ï¼‰
2. **æ¸²æŸ“ç»“æœå¯ä»¥ç¼“å­˜**ï¼ˆHTML å­—ç¬¦ä¸²ï¼‰
3. **ç¼“å­˜ HTML æ¯”ç¼“å­˜æ•°æ®æ•ˆæœå¥½ 100 å€**

### æœ€ä½³å®è·µ

```javascript
// âœ… æ¨èï¼šç¼“å­˜æœ€ç»ˆ HTML
const htmlCache = new LRU({ max: 1000 });

app.get('/item/:id', async (req, res) => {
  let html = htmlCache.get(req.params.id);

  if (!html) {
    const data = await fetchData(req.params.id);
    html = renderToString(<Page data={data} />);
    htmlCache.set(req.params.id, html, 300);
  }

  res.send(html);
});
```

### æ€§èƒ½æ•°æ®

| æ–¹æ¡ˆ | å¹³å‡å“åº”æ—¶é—´ | æ€§èƒ½æå‡ |
|-----|------------|---------|
| ä¸ç¼“å­˜ | 200ms | åŸºå‡† |
| åªç¼“å­˜æ•°æ® | 101ms | 2å€ |
| ç¼“å­˜ HTML | **1ms** | **200å€** |

### è®°å¿†å£è¯€

```
æ¸²æŸ“é€»è¾‘æ˜¯ä»£ç ï¼Œä¸éœ€è¦ç¼“å­˜
æ¸²æŸ“ç»“æœæ˜¯æ•°æ®ï¼Œå¿…é¡»è¦ç¼“å­˜
ç¼“å­˜ HTML æœ€é«˜æ•ˆï¼Œæ€§èƒ½æå‡ä¸¤ç™¾å€
```

---

## ğŸ“ é¢è¯•å›ç­”æ¨¡æ¿

**é—®ï¼šSSR ä¸­çš„æ¸²æŸ“é€»è¾‘å¯ä»¥ç¼“å­˜å—ï¼Ÿ**

**ç­”**ï¼š
> "æ¸²æŸ“é€»è¾‘æœ¬èº«ä¸èƒ½ç¼“å­˜ï¼Œä½†æ¸²æŸ“ç»“æœå¯ä»¥ç¼“å­˜ã€‚
>
> æ¸²æŸ“é€»è¾‘æ˜¯ä»£ç ï¼Œå·²ç»åœ¨æœåŠ¡å™¨å†…å­˜ä¸­äº†ï¼Œä¸éœ€è¦ç¼“å­˜ã€‚æˆ‘ä»¬éœ€è¦ç¼“å­˜çš„æ˜¯æ‰§è¡Œæ¸²æŸ“é€»è¾‘åäº§ç”Ÿçš„ HTML å­—ç¬¦ä¸²ã€‚
>
> åœ¨æˆ‘çš„é¡¹ç›®ä¸­ï¼Œæˆ‘å®ç°äº†å¤šçº§ç¼“å­˜ï¼šL1 å†…å­˜ç¼“å­˜ + L2 Redis ç¼“å­˜ã€‚ç¼“å­˜å‘½ä¸­ç‡è¾¾åˆ° 95%ï¼Œå“åº”æ—¶é—´ä» 200ms é™åˆ° 1msï¼Œæ€§èƒ½æå‡ 200 å€ã€‚
>
> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰å…¬å…±å†…å®¹ï¼ˆå¦‚å•†å“é¡µï¼‰æ‰é€‚åˆç¼“å­˜ï¼Œä¸ªæ€§åŒ–å†…å®¹ï¼ˆå¦‚ç”¨æˆ·ä¸­å¿ƒï¼‰å’Œå®æ—¶æ•°æ®ï¼ˆå¦‚ç§’æ€ï¼‰ä¸åº”è¯¥ç¼“å­˜ã€‚"
